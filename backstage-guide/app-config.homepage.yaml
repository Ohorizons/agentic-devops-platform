# app-config.homepage.yaml
# Backstage Open Horizons â€” Homepage & GitHub Auth Configuration
# This configuration enables the custom homepage plugin with GitHub-only authentication

app:
  title: Open Horizons
  baseUrl: ${BACKSTAGE_BASE_URL}
  analytics:
    ga4:
      measurementId: ${GA4_MEASUREMENT_ID:null}

# GitHub-only authentication
auth:
  environment: production
  providers:
    github:
      production:
        clientId: ${GITHUB_CLIENT_ID}
        clientSecret: ${GITHUB_CLIENT_SECRET}
        enterpriseInstanceUrl: ${GITHUB_ENTERPRISE_URL:''}

# Sign-in configuration - GitHub only
signInPage: github

# Backend database configuration
backend:
  baseUrl: ${BACKSTAGE_BASE_URL}
  listen:
    port: 7007
    host: 0.0.0.0
  csp:
    connect-src:
      - 'self'
      - 'http://localhost:7007'
      - 'https://github.com'
  auth:
    keys:
      - secret: ${BACKEND_SECRET:insecure-secret}

# Frontend configuration
frontend:
  baseUrl: ${BACKSTAGE_BASE_URL}
  app:
    baseUrl: /

# Catalog configuration with GitHub integration
catalog:
  import:
    entityFilename: catalog-info.yaml
  rules:
    - allow:
        - Component
        - API
        - Resource
        - System
        - Domain
        - User
        - Group
        - Location
  providers:
    github:
      providerId: production
      organization: ${GITHUB_ORG}
      catalogPath: /catalog-info.yaml
      filters:
        branch: main
        repository: '^(open-horizons|platform-.*)'
      schedule:
        frequency:
          minutes: 30
        timeout:
          minutes: 10
  locations:
    - type: github-discovery
      target:
        - url: https://github.com/${GITHUB_ORG}
          rules:
            - allow:
                - Component
                - API
                - System
                - Group
                - Template
            - allow:
                - Location
              if:
                matchingPattern: '^https:\/\/github\.com\/.*\/catalog-info\.yaml$'

# Plugin configuration
plugins:
  # Home plugin - provides the custom homepage
  '@backstage/plugin-home':
    dynamicLoading: true
    mountPoints:
      - module: OpenHorizonsdHomePage
        importName: OpenHorizonsHomePage
        disabled: false

  # Search plugin
  '@backstage/plugin-search':
    dynamicLoading: true

  # GitHub plugin for repository browsing
  '@backstage/plugin-github-actions':
    dynamicLoading: true
    gitHubUrl: ${GITHUB_URL:https://github.com}

  # Catalog plugin
  '@backstage/plugin-catalog':
    dynamicLoading: true

# Proxy endpoints
proxy:
  '/github/api':
    target: https://api.github.com
    allowedMethods: ['GET']
    auth: github
    changeOrigin: true
    pathRewrite:
      '^/github/api': ''

# Homepage plugin configuration
homepage:
  # Enable the custom homepage
  enabled: true
  defaultPath: /

  # Search bar configuration
  searchBar:
    enabled: true
    placeholder: Search components, templates, and documentation

  # Custom links section
  quickAccessLinks:
    enabled: true
    links:
      - title: Getting Started
        description: Begin your journey with Open Horizons
        url: /docs/getting-started
        icon: help
      - title: Software Catalog
        description: Discover all registered components
        url: /catalog
        icon: storage
      - title: Create Component
        description: Use templates to scaffold new services
        url: /create
        icon: add
      - title: Documentation
        description: View platform documentation
        url: /docs
        icon: description

  # Featured templates
  featuredTemplates:
    enabled: true
    count: 4
    refresh:
      minutes: 30

  # Starred entities
  starredEntities:
    enabled: true
    count: 6

  # Recent entities
  recentEntities:
    enabled: true
    count: 5

# Organization configuration
organization:
  name: Open Horizons

# Logging configuration
logger:
  level: info
  transports:
    - type: stream
      format: coloredWithTimestamps
